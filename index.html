<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Amor Engine Final</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <style>
        :root {
            --primary: #ff4d6d;
            --neon-shadow: 0 0 10px #ff4d6d, 0 0 20px #ff4d6d;
        }

        body {
            margin: 0; height: 100vh; display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            font-family: 'Segoe UI', sans-serif; overflow: hidden; cursor: none;
            transition: background 0.5s;
        }

       /* --- –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –°–ï–¢–ö–ê (–í–°–¢–ê–í–õ–Ø–¢–¨ –°–Æ–î–ê) --- */
        .board { 
            display: grid; 
            grid-template-columns: repeat(3, 110px); 
            grid-template-rows: repeat(3, 110px); 
            gap: 15px; 
            z-index: 10; 
            position: relative;
            width: 360px; /* –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —à–∏—Ä–∏–Ω–∞ –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ */
            height: 360px;
        }

        .board::before, .board::after {
            content: '';
            position: absolute;
            pointer-events: none;
            z-index: -1;
        }

       /* 1. –°–ï–¢–ö–ê –ò–ó –°–ï–†–î–ï–ß–ï–ö ‚Äî –ú–ï–¢–û–î BACKGROUND REPEAT */
        .grid-hearts::before {
            content: '';
            position: absolute;
            left: 110px; top: 0; bottom: 0; width: 140px;
            z-index: -1;
            /* –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ñ–æ–Ω –≤–º–µ—Å—Ç–æ —Ä–∞–º–∫–∏ */
            background-image: url('https://cdn-icons-png.flaticon.com/512/833/833472.png'), 
                              url('https://cdn-icons-png.flaticon.com/512/833/833472.png');
            background-position: left center, right center;
            background-repeat: repeat-y; /* –ü–æ–≤—Ç–æ—Ä—è–µ–º —Ç–æ–ª—å–∫–æ –ø–æ –≤–µ—Ä—Ç–∏–∫–∞–ª–∏ */
            background-size: 20px; /* –†–∞–∑–º–µ—Ä –æ–¥–Ω–æ–≥–æ —Å–µ—Ä–¥–µ—á–∫–∞ */
        }

        .grid-hearts::after {
            content: '';
            position: absolute;
            top: 110px; left: 0; right: 0; height: 140px;
            z-index: -1;
            background-image: url('https://cdn-icons-png.flaticon.com/512/833/833472.png'), 
                              url('https://cdn-icons-png.flaticon.com/512/833/833472.png');
            background-position: center top, center bottom;
            background-repeat: repeat-x; /* –ü–æ–≤—Ç–æ—Ä—è–µ–º —Ç–æ–ª—å–∫–æ –ø–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª–∏ */
            background-size: 20px;
        }

        /* 2. –°–ï–¢–ö–ê –ü–£–ù–ö–¢–ò–†–û–ú */
        .grid-dots::before {
            left: 110px; width: 140px; top: 0; bottom: 0;
            border-left: 3px dashed var(--primary); border-right: 3px dashed var(--primary);
        }
        .grid-dots::after {
            top: 110px; height: 140px; left: 0; right: 0;
            border-top: 3px dashed var(--primary); border-bottom: 3px dashed var(--primary);
        }

        /* 3. –°–ï–¢–ö–ê –ù–ï–û–ù–û–í–ê–Ø */
        .grid-neon::before {
            left: 110px; width: 140px; top: 0; bottom: 0;
            border-left: 2px solid #fff; border-right: 2px solid #fff;
            filter: drop-shadow(0 0 10px var(--primary));
        }
        .grid-neon::after {
            top: 110px; height: 140px; left: 0; right: 0;
            border-top: 2px solid #fff; border-bottom: 2px solid #fff;
            filter: drop-shadow(0 0 10px var(--primary));
        }
        /* --- –ö–û–ù–ï–¶ –ë–õ–û–ö–ê –°–ï–¢–ö–ò --- */
       
        .cell {
            width: 110px; height: 110px;
            display: flex; align-items: center; justify-content: center;
            font-size: 50px; transition: all 0.3s ease; 
            background: transparent; /* –ü—Ä–æ–∑—Ä–∞—á–Ω—ã–µ —è—á–µ–π–∫–∏ –¥–ª—è —Å—Ç–∏–ª—è –∫–∞–∫ –Ω–∞ —Å–∫—Ä–∏–Ω—à–æ—Ç–µ */
            cursor: none;
        }

        /* –ö–£–†–°–û–† –ò –ü–´–õ–¨–¶–ê */
        #custom-cursor {
            position: fixed; width: 60px; pointer-events: none; z-index: 9999;
            transform: translate(-50%, -50%); filter: drop-shadow(0 0 5px gold);
        }
        .particle {
            position: fixed; pointer-events: none; z-index: 9998;
            font-size: 10px; animation: magic 1.5s forwards;
            text-shadow: 0 0 5px white, 0 0 10px var(--primary);
        }
        @keyframes magic {
            0% { transform: translate(0,0) scale(1) rotate(0deg); opacity: 1; }
            100% { transform: translate(var(--dx), var(--dy)) scale(0) rotate(360deg); opacity: 0; }
        }

        /* –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û */
        #modal {
            display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: white; padding: 30px; border-radius: 30px; z-index: 100;
            box-shadow: 0 20px 50px rgba(0,0,0,0.3); text-align: center; width: 320px;
        }
        #q-img { max-width: 100%; border-radius: 15px; margin-bottom: 10px; display: none; }
        .btn { background: var(--primary); color: white; border: none; padding: 10px 20px; border-radius: 15px; cursor: pointer; margin-top: 10px; font-weight: bold;}
        #status { font-size: 24px; color: var(--primary); margin-bottom: 20px; font-weight: bold; z-index: 10; text-shadow: 1px 1px 5px white; }
    </style>
</head>
<body id="main-body">

    <div id="status"></div>
    <div id="board" class="board"></div>

    <div id="modal">
        <h3 id="modal-team" style="color: var(--primary); margin-top: 0;"></h3>
        <img id="q-img" src="">
        <p id="q-text" style="font-size: 18px; margin-top: 5px;"></p>
        <input type="text" id="ans-input" style="width: 80%; padding: 10px; margin-bottom: 10px; border: 2px solid #ffb3c1; border-radius: 10px; outline: none;">
        <br>
        <button class="btn" onclick="check()">–û–¢–í–ï–¢–ò–¢–¨</button>
    </div>

    <img id="custom-cursor" src="">

    <script>
        const p = new URLSearchParams(window.location.search);

        // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫—É—Ä—Å–æ—Ä–∞
        document.getElementById('custom-cursor').src = p.get('cur') || 'https://cdn-icons-png.flaticon.com/512/3588/3588640.png';
        
        // 1. –§–æ–Ω
        const bgs = {
            'romance': 'linear-gradient(135deg, #fff0f5, #ffdee9)',
            'science': 'radial-gradient(circle, #ffffff 0%, #ffdee9 100%)',
            'modern': '#ffb3c1'
        };
        document.getElementById('main-body').style.background = bgs[p.get('bg')] || bgs['romance'];

        // 2. –°–µ—Ç–∫–∞
        const board = document.getElementById('board');
        board.classList.add('grid-' + (p.get('grid') || 'hearts'));

        // 3. –ö–æ–º–∞–Ω–¥—ã
        const t1 = { name: p.get('t1') || "–ö–æ–º–∞–Ω–¥–∞ 1", sym: "‚ù§Ô∏è" };
        const t2 = { name: p.get('t2') || "–ö–æ–º–∞–Ω–¥–∞ 2", sym: "‚úâÔ∏è" };
        let cur = 1;

        // 4. –ü—ã–ª—å—Ü–∞
        document.addEventListener('mousemove', (e) => {
            const c = document.getElementById('custom-cursor');
            c.style.left = e.clientX + 'px'; c.style.top = e.clientY + 'px';
            if(Math.random() > 0.7) {
                const part = document.createElement('div');
                part.className = 'particle';
                const curSrc = document.getElementById('custom-cursor').src;
                let types = ['‚ú®', 'üíñ', 'üå∏', '‚ö™']; 
                if (curSrc.includes('833472')) types = ['‚ù§Ô∏è', 'üíñ', 'üíï', '‚ú®'];
                if (curSrc.includes('2904973')) types = ['‚ö°', '‚ú®', 'üî•', 'üî∏'];
                part.innerText = types[Math.floor(Math.random()*types.length)];
                part.style.left = e.clientX + 'px'; part.style.top = e.clientY + 'px';
                part.style.setProperty('--dx', (Math.random()*100 - 50) + 'px');
                part.style.setProperty('--dy', (Math.random()*100 - 50) + 'px');
                document.body.appendChild(part);
                setTimeout(() => part.remove(), 1500);
            }
        });

        // 5. –õ–æ–≥–∏–∫–∞ –∏–≥—Ä—ã
        const status = document.getElementById('status');
        status.innerText = "–•–æ–¥: " + t1.name;

        for(let i=0; i<9; i++) {
            const cell = document.createElement('div');
            cell.className = 'cell';
            cell.onclick = () => {
                if(cell.innerText !== "") return;
                const qData = (p.get('q'+(i+1)) || "||").split('|');
                window.currentQ = { q: qData[0], a: qData[1], img: qData[2] };
                
                document.getElementById('modal').style.display = 'block';
                document.getElementById('q-text').innerText = window.currentQ.q;
                
                const imgTag = document.getElementById('q-img');
                if (window.currentQ.img && window.currentQ.img.trim() !== "") {
                    imgTag.src = window.currentQ.img;
                    imgTag.style.display = 'block';
                } else {
                    imgTag.style.display = 'none';
                }
                
                document.getElementById('modal-team').innerText = (cur === 1 ? t1.name : t2.name);
                document.getElementById('ans-input').value = "";
                window.activeCell = cell;
            };
            board.appendChild(cell);
        }

        function check() {
            const userAns = document.getElementById('ans-input').value.toLowerCase().trim();
            const correctAns = (window.currentQ.a || "").toLowerCase().trim();

            if(userAns === correctAns || correctAns === "") {
                window.activeCell.innerText = cur === 1 ? t1.sym : t2.sym;
                if(checkWin()) {
                    status.innerText = "üèÜ –ü–û–ë–ï–î–ê: " + (cur === 1 ? t1.name : t2.name);
                    board.style.pointerEvents = 'none';
                    launchCelebrate();
                } else {
                    switchPlayer();
                }
            } else {
                alert("–ù–µ–≤–µ—Ä–Ω–æ!");
                switchPlayer();
            }
            document.getElementById('modal').style.display = 'none';
        }

        function switchPlayer() {
            cur = cur === 1 ? 2 : 1;
            status.innerText = "–•–æ–¥: " + (cur === 1 ? t1.name : t2.name);
        }

        function checkWin() {
            const cells = Array.from(board.children).map(c => c.innerText);
            const wins = [[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];
            return wins.some(w => cells[w[0]]!=="" && cells[w[0]]===cells[w[1]] && cells[w[1]]===cells[w[2]]);
        }

        function launchCelebrate() {
            const duration = 5 * 1000;
            const animationEnd = Date.now() + duration;
            const interval = setInterval(function() {
                const timeLeft = animationEnd - Date.now();
                if (timeLeft <= 0) return clearInterval(interval);
                confetti({ 
                    particleCount: 40, spread: 360, 
                    origin: { x: Math.random(), y: Math.random() - 0.2 },
                    colors: ['#ff4d6d', '#ffb3c1', '#ff758f']
                });
            }, 250);
        }
    </script>
</body>
</html>
